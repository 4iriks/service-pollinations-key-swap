# Service Pollinations Key Swap

–ü—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–∏—Å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ —Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ Pollinations API —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Å–≤–∞–ø–æ–º –∫–ª—é—á–µ–π.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
–ë–æ—Ç-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä 1 ‚îÄ‚îÄPOST /generate‚îÄ‚îÄ‚Üí [–°–ï–†–í–ò–°] ‚îÄ‚îÄVLESS‚îÄ‚îÄ‚Üí Pollinations API
–ë–æ—Ç-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä 2 ‚îÄ‚îÄPOST /generate‚îÄ‚îÄ‚Üí [–°–ï–†–í–ò–°]              ‚Üì
                 ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ –∫–∞—Ä—Ç–∏–Ω–∫–∞ ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ –∫–∞—Ä—Ç–∏–Ω–∫–∞
```

- –•—Ä–∞–Ω–∏—Ç API –∫–ª—é—á–∏ Pollinations –∏ VLESS –∫–æ–Ω—Ñ–∏–≥–∏
- –†–æ—É—Ç–∏—Ç –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ VLESS —Ç—É–Ω–Ω–µ–ª–∏ (XRAY)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≤–∞–ø–∞–µ—Ç –∫–ª—é—á–∏ –ø—Ä–∏ –∏—Å—á–µ—Ä–ø–∞–Ω–∏–∏ –±–∞–ª–∞–Ω—Å–∞
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç (inline –∫–Ω–æ–ø–∫–∏)
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –ø–æ IP —Å –æ–¥–æ–±—Ä–µ–Ω–∏–µ–º –∞–¥–º–∏–Ω–∞

## –ó–∞–ø—É—Å–∫

```bash
cp .env.example .env
# –ó–∞–ø–æ–ª–Ω–∏—Ç–µ .env

docker compose build && docker compose up -d
```

## API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### `POST /generate` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

```bash
curl -X POST http://localhost:8080/generate \
  -H "Content-Type: application/json" \
  -d '{"prompt": "a cute cat", "model": "flux", "width": 1024, "height": 1024}' \
  -o image.png
```

–û—Ç–≤–µ—Ç: –±–∞–π—Ç—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (`content-type: image/...`)

–ö–æ–¥—ã –æ—à–∏–±–æ–∫:
- `403` ‚Äî —Å–µ—Ä–≤–∏—Å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω (–æ–∂–∏–¥–∞–µ—Ç –æ–¥–æ–±—Ä–µ–Ω–∏—è –∞–¥–º–∏–Ω–∞)
- `503` ‚Äî –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–ª—é—á–µ–π
- `502` ‚Äî –æ—à–∏–±–∫–∞ Pollinations API

### `POST /text` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞

```bash
curl -X POST http://localhost:8080/text \
  -H "Content-Type: application/json" \
  -d '{"prompt": "describe a cat", "model": "openai"}'
```

–û—Ç–≤–µ—Ç: `{"text": "..."}`

### `GET /health` ‚Äî healthcheck

```bash
curl http://localhost:8080/health
```

–û—Ç–≤–µ—Ç: `{"status": "ok", "active_keys": 3, "xray": true}`

### `GET /status` ‚Äî —Å—Ç–∞—Ç—É—Å –∫–ª—é—á–µ–π

```bash
curl http://localhost:8080/status
```

–û—Ç–≤–µ—Ç: `{"keys": [{"masked": "abc123...", "balance": 2.63, "active": true, "vless": "config-name"}]}`

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏–∑ Python

```python
import aiohttp

async def generate_image(prompt: str) -> bytes:
    async with aiohttp.ClientSession() as session:
        async with session.post(
            "http://your-service:8080/generate",
            json={"prompt": prompt, "model": "flux"},
        ) as resp:
            if resp.status == 200:
                return await resp.read()
            raise Exception(f"Error: {resp.status}")
```

## –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ —Å –Ω–æ–≤–æ–≥–æ IP:
1. –°–µ—Ä–≤–∏—Å —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ `pending`
2. –ê–¥–º–∏–Ω –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram —Å –∫–Ω–æ–ø–∫–∞–º–∏:
   - ‚úÖ –û–¥–æ–±—Ä–∏—Ç—å ‚Äî —Å–µ—Ä–≤–∏—Å –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø
   - ‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å ‚Äî –∑–∞–ø—Ä–æ—Å—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è (–º–æ–∂–Ω–æ –æ–¥–æ–±—Ä–∏—Ç—å –ø–æ–∑–∂–µ)
   - üö´ –ó–∞–±–∞–Ω–∏—Ç—å ‚Äî –ø–µ—Ä–º–∞–Ω–µ–Ω—Ç–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|---|---|---|
| `SERVICE_BOT_TOKEN` | –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ | **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** |
| `ADMIN_IDS` | ID –∞–¥–º–∏–Ω–æ–≤ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é | **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** |
| `API_HOST` | –•–æ—Å—Ç API —Å–µ—Ä–≤–µ—Ä–∞ | `0.0.0.0` |
| `API_PORT` | –ü–æ—Ä—Ç API —Å–µ—Ä–≤–µ—Ä–∞ | `8080` |
| `DB_PATH` | –ü—É—Ç—å –∫ SQLite –ë–î | `service.db` |
| `VLESS_CONFIGS` | VLESS URL —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é | ‚Äî |
| `BALANCE_THRESHOLD` | –ü–æ—Ä–æ–≥ –±–∞–ª–∞–Ω—Å–∞ –¥–ª—è –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏ | `0.1` |
| `BALANCE_CHECK_INTERVAL` | –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∞–ª–∞–Ω—Å–æ–≤ (—Å–µ–∫) | `60` |

## Telegram –±–æ—Ç

–ö–æ–º–∞–Ω–¥–∞ `/start` ‚Äî –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:

- üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** ‚Äî –∫–ª—é—á–∏, –±–∞–ª–∞–Ω—Å, –∑–∞–ø—Ä–æ—Å—ã, XRAY —Å—Ç–∞—Ç—É—Å, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º
- üîë **–ö–ª—é—á–∏** ‚Äî —Å–ø–∏—Å–æ–∫ —Å –±–∞–ª–∞–Ω—Å–∞–º–∏, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ VLESS, —É–¥–∞–ª–µ–Ω–∏–µ
- üåê **VLESS** ‚Äî —Å–ø–∏—Å–æ–∫ –∫–æ–Ω—Ñ–∏–≥–æ–≤, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ
- üì° **–°–µ—Ä–≤–∏—Å—ã** ‚Äî –ø–æ–¥–∫–ª—é—á—ë–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã, –æ–¥–æ–±—Ä–µ–Ω–∏–µ/–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞–∂–¥–æ–º—É
